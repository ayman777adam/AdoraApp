<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Adora | ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥Ø´ØºØ§Ù„ (Adora)</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ============================================================
           CSS (Adora Deluxe Theme - Occupancy V2)
           ============================================================ */
        :root {
            /* Adora Identity Colors */
            --adora-turquoise: #00838f;
            --adora-orange: #ff6f00;
            
            --bg-body: #f4f8f9;
            --bg-card: rgba(255, 255, 255, 0.85);
            --text-main: #263238;
            --text-sec: #546e7a;
            --border-color: rgba(0, 131, 143, 0.1);
            
            --primary: var(--adora-turquoise);
            --primary-light: rgba(0, 131, 143, 0.08);
            
            --success: #00b894;
            --danger: #ff5252;
            --warning: var(--adora-orange);
            --upgrade: #7e57c2;

            /* Room Colors (Adora Adapted) */
            --color-single: #00acc1;  /* Cyan-ish Turquoise */
            --color-suite: #ffa000;   /* Deep Amber */
            
            --shadow: 0 10px 40px -5px rgba(0, 131, 143, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
            
            /* Glassmorphism Variables */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --blur-val: blur(16px);
        }

        /* ğŸ”¥ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ Ø§Ù„ÙØ§Ø®Ø± (Adora Night) */
        body.dark-mode { 
            --bg-body: #002529; 
            --bg-card: rgba(0, 54, 58, 0.8); 
            --text-main: #e0f7fa; 
            --text-sec: #80cbc4; 
            --border-color: rgba(255, 255, 255, 0.1); 
            --primary: #4dd0e1; 
            --primary-light: rgba(77, 208, 225, 0.1);
            --shadow: 0 10px 30px rgba(0,0,0,0.5);
            --glass-bg: rgba(0, 30, 33, 0.75);
            --glass-border: 1px solid rgba(255, 255, 255, 0.05);
            --warning: #ffab40;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 10px 15px 220px 15px;
            -webkit-tap-highlight-color: transparent;
            transition: 0.3s;
            overflow-x: hidden;
            
            /* Ø®Ù„ÙÙŠØ© Ø®Ø·ÙˆØ· Adora */
            background-image: 
                linear-gradient(45deg, rgba(0, 131, 143, 0.03) 25%, transparent 25%, transparent 75%, rgba(0, 131, 143, 0.03) 75%, rgba(0, 131, 143, 0.03)), 
                linear-gradient(45deg, rgba(0, 131, 143, 0.03) 25%, transparent 25%, transparent 75%, rgba(0, 131, 143, 0.03) 75%, rgba(0, 131, 143, 0.03));
            background-position: 0 0, 30px 30px;
            background-size: 60px 60px;
        }

        .container { max-width: 500px; margin: 0 auto; }

        /* --- Adora Header Glass --- */
        .header-glass {
            background: var(--glass-bg);
            backdrop-filter: var(--blur-val); -webkit-backdrop-filter: var(--blur-val);
            border: var(--glass-border);
            border-radius: 30px; 
            padding: 10px 20px; 
            margin-bottom: 25px;
            margin-top: 10px;
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: var(--glass-shadow);
            position: sticky; top: 10px; z-index: 100;
            flex-wrap: nowrap;
        }
        
        .header-title img {
            max-height: 50px; width: auto; /* Ø¶Ø¨Ø· Ø­Ø¬Ù… Ø§Ù„Ø´Ø¹Ø§Ø± Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø£Ù†ÙŠÙ‚ */
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .tools-area { 
            display: flex; align-items: center; gap: 8px; 
        }

        .tools-btn { 
            background: rgba(0,0,0,0.03); border: none; padding: 8px; border-radius: 50%; 
            width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 1.1rem; transition: 0.2s; color: var(--text-main);
        }
        .tools-btn:active { transform: scale(0.9); background: var(--primary-light); }

        .season-toggle {
            display: flex; align-items: center; gap: 6px;
            background: var(--bg-card); border: 1px solid var(--border-color);
            padding: 6px 12px; border-radius: 50px; cursor: pointer;
            font-size: 0.8rem; font-weight: bold; transition: 0.3s; color: var(--text-sec);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .season-toggle.active { background: var(--primary); border-color: var(--primary); color: white; }
        .season-dot { width: 8px; height: 8px; border-radius: 50%; background: #cfd8dc; transition:0.3s;}
        .season-toggle.active .season-dot { background: white; box-shadow: 0 0 5px rgba(255,255,255,0.5); }

        /* --- Dashboard Cards --- */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .card { 
            background: var(--bg-card); border-radius: 28px; padding: 20px; 
            position: relative; box-shadow: var(--shadow); border: 1px solid var(--border-color);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-bottom: none; transition: transform 0.2s;
            backdrop-filter: blur(5px);
        }
        .card:active { transform: scale(0.98); }
        
        .chart-container { position: relative; width: 80px; height: 80px; margin-bottom: 8px; }
        .circular-chart { display: block; margin: 0 auto; max-width: 100%; max-height: 250px; }
        .circle-bg { fill: none; stroke: rgba(0,0,0,0.05); stroke-width: 3; }
        body.dark-mode .circle-bg { stroke: rgba(255,255,255,0.05); }
        
        .circle { fill: none; stroke-width: 3; stroke-linecap: round; transition: stroke-dasharray 0.6s ease; }
        .percentage { fill: var(--text-main); font-family: 'Tajawal'; font-weight: 800; font-size: 0.55em; text-anchor: middle; }
        
        .card-label { font-size: 0.9rem; font-weight: 800; margin-bottom: 2px; }
        .card-sub { font-size: 0.7rem; opacity: 0.7; font-weight: bold; }
        
        .c-single .circle { stroke: var(--color-single); } .c-single .card-label { color: var(--color-single); }
        .c-suite .circle { stroke: var(--color-suite); } .c-suite .card-label { color: var(--color-suite); }

        /* --- Price Bar --- */
        .price-bar {
            background: var(--bg-card); border-radius: 24px; padding: 15px 20px;
            margin-bottom: 25px; box-shadow: var(--shadow); border: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            border-left: none; position: relative; overflow: hidden;
            backdrop-filter: blur(5px);
        }
        /* Ù…Ø¤Ø´Ø± Ø¬Ø§Ù†Ø¨ÙŠ Ù…Ù„ÙˆÙ† */
        .price-bar::before { content:''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: #ccc; }
        
        .price-label { font-size: 0.85rem; color: var(--text-sec); font-weight: 700; z-index: 1; }
        .price-values { display: flex; gap: 15px; font-weight: 800; font-size: 1.1rem; z-index: 1; }
        .p-val span { font-size: 0.7rem; font-weight: normal; opacity: 0.8; margin-left: 3px; }
        
        .price-mode-std::before { background: var(--success); } 
        .price-mode-std { background: linear-gradient(to right, rgba(0, 184, 148, 0.05), var(--bg-card)); }
        
        .price-mode-med::before { background: var(--warning); }
        .price-mode-med { background: linear-gradient(to right, rgba(255, 111, 0, 0.05), var(--bg-card)); }
        
        .price-mode-high::before { background: var(--danger); }
        .price-mode-high { background: linear-gradient(to right, rgba(255, 82, 82, 0.05), var(--bg-card)); }

        /* --- Sections & Steppers --- */
        .section { 
            background: var(--bg-card); border-radius: 28px; padding: 20px; 
            margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid var(--border-color); 
            backdrop-filter: blur(5px);
        }
        .sec-title { 
            font-weight: 800; font-size: 1.1rem; margin-bottom: 20px; padding-bottom: 0; 
            border-bottom: none; color: var(--text-main); 
            display: flex; align-items: center;
        }
        .sec-title::before { content: ''; width: 6px; height: 6px; background: var(--warning); border-radius: 50%; margin-left: 8px; }

        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .control-label { flex: 1; font-size: 0.95rem; font-weight: 700; color: var(--text-sec); }
        
        .stepper { 
            display: flex; align-items: center; gap: 5px; 
            background: var(--bg-body); padding: 4px; border-radius: 50px; 
            border: 1px solid var(--border-color); 
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.02);
        }
        .step-btn {
            width: 40px; height: 40px; border: none; border-radius: 50%;
            background: var(--bg-card); cursor: pointer; font-weight: bold; font-size: 1.2rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); color: var(--text-main);
            transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .step-btn:active { transform: scale(0.9); background: var(--primary-light); }
        .btn-minus { color: var(--danger); } .btn-plus { color: var(--success); }
        
        .val-display { font-size: 1.2rem; font-weight: 800; width: 40px; text-align: center; color: var(--primary); }
        .pop-anim { animation: pop 0.2s ease; color: var(--upgrade); }
        @keyframes pop { 50% { transform: scale(1.4); } }

        .cap-bar-bg { height: 6px; background: rgba(0,0,0,0.05); border-radius: 10px; margin-top: 8px; width: 100%; position: relative; overflow: hidden; }
        .cap-bar-fill { height: 100%; width: 0%; background: var(--success); transition: width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), background 0.3s; border-radius: 10px; }
        .lbl-single { color: var(--color-single); } .lbl-suite { color: var(--color-suite); }

        /* --- Footer & Sticky --- */
        .sticky-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--glass-bg);
            backdrop-filter: var(--blur-val); -webkit-backdrop-filter: var(--blur-val);
            border-top: 1px solid rgba(255,255,255,0.3);
            padding: 15px 20px 25px 20px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.05);
            z-index: 999;
            display: flex; flex-direction: column; gap: 10px;
            box-sizing: border-box; border-radius: 30px 30px 0 0;
        }
        body.dark-mode .sticky-footer { background: rgba(30,30,30,0.9); }

        .advice-container { display: flex; gap: 10px; }
        .advice-pill {
            flex: 1; padding: 12px; border-radius: 20px; text-align: center;
            font-weight: 800; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); transition: 0.3s;
        }
        .pill-green { background: #e0f2f1; color: #00695c; border: 1px solid transparent; }
        .pill-red { background: #ffebee; color: #c62828; border: 1px solid transparent; }

        .actions-row { display: flex; gap: 10px; }
        #submit-btn {
            flex: 1; padding: 15px; border: none; border-radius: 20px;
            background: linear-gradient(135deg, var(--primary), #00acc1);
            color: white; font-weight: 800; font-size: 1.1rem;
            cursor: pointer; box-shadow: 0 8px 20px rgba(0, 131, 143, 0.2);
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: transform 0.2s;
        }
        #submit-btn:active { transform: scale(0.97); }
        
        #copy-btn { 
            width: 55px; border: none; border-radius: 20px; background: var(--bg-card); 
            color: var(--text-sec); font-size: 1.2rem; cursor: pointer; 
            border: 1px solid var(--border-color); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        .footer-credits {
            text-align: center; font-size: 0.7rem; color: var(--text-sec); opacity: 0.8;
            padding-top: 5px; margin-top: 0;
        }

        #game-toast {
            position: fixed; top: 90px; left: 50%; transform: translateX(-50%);
            background: var(--text-main); color: var(--bg-body); padding: 10px 20px; border-radius: 50px;
            font-size: 0.85rem; font-weight: bold; opacity: 0; pointer-events: none;
            transition: 0.3s; z-index: 2000; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex; align-items: center; gap: 8px;
        }
        #game-toast.show { opacity: 1; top: 100px; }

        .alert-upgrade { 
            background: rgba(126, 87, 194, 0.1); color: var(--upgrade); 
            padding: 12px; border-radius: 20px; border: 1px solid rgba(126, 87, 194, 0.2); 
            text-align: center; font-size: 0.9rem; margin-bottom: 20px; display: none; 
            font-weight: bold; animation: pulsePurple 2s infinite;
        }
        @keyframes pulsePurple { 0% {box-shadow: 0 0 0 0 rgba(126, 87, 194, 0.2);} 70% {box-shadow: 0 0 0 5px rgba(126, 87, 194, 0);} }
        
        /* Modals */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0, 30, 33, 0.5); display: none; justify-content: center; align-items: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal-content { 
            background: var(--bg-card); padding: 30px; border-radius: 35px; width: 85%; max-width: 350px; text-align: center; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2);
        }
        .math-row { display: flex; justify-content: space-between; margin-bottom: 10px; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; font-size: 0.9rem; }
        
        #password-modal input { 
            width: 100%; padding: 15px; margin: 20px 0; 
            border: 2px solid transparent; border-radius: 15px; background: var(--bg-body);
            box-sizing: border-box; text-align: center; font-size: 1rem; font-weight: bold; color: var(--text-main);
            transition: 0.3s;
        }
        #password-modal input:focus { border-color: var(--primary); background: white; outline: none; }
        
        /* ğŸ”¥ CSS Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© ÙÙ‚Ø· */
        @media print {
            .tools-area, .sticky-footer, .season-toggle, #game-toast, #upgrade-alert, #sync-indicator { display: none !important; }
            body { padding: 0; background: white; color: black; -webkit-print-color-adjust: exact; print-color-adjust: exact; background-image: none; }
            .container { max-width: 100%; margin: 0; }
            .card, .section, .price-bar { box-shadow: none; border: 1px solid #ccc; break-inside: avoid; border-radius: 10px; }
            .header-glass { box-shadow: none; border-bottom: 1px solid #000; border-radius: 0; position: static; background: white; }
        }

        /* ğŸ”¥ Desktop Optimization */
        @media (min-width: 768px) {
            .container { max-width: 900px; }
            .header-glass { padding: 15px 30px; }
            .dashboard { grid-template-columns: 1fr 1fr 1fr 1fr; gap: 20px; }
            .card { padding: 25px 15px; }
            .section { padding: 25px 30px; }
            .step-btn { width: 35px; height: 35px; }
            .val-display { font-size: 1.1rem; width: 45px; }
            .sticky-footer { left: auto; right: auto; width: 100%; max-width: 900px; margin: 0 auto; border-radius: 30px 30px 0 0; }
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-glass">
           <div class="header-title" style="display:flex;align-items:center;gap:10px;">
                <img src="adora-logo.png" alt="ADORA Logo" style="height:90px; width:auto;">
           </div>

            <div class="tools-area">
                <button class="tools-btn" onclick="showResetModal()" title="ØªØµÙÙŠØ±">ğŸ”„</button>
                <button class="tools-btn" onclick="toggleDarkMode()" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ">ğŸŒ™</button>
                <div class="season-toggle" id="season-btn" onclick="toggleSeason()">
                    <div class="season-dot"></div> Ù…ÙˆØ³Ù…
                </div>
            </div>
        </div>
        
        <div id="game-toast">ğŸš€ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´ÙØª: <span id="sales-count">0</span></div>
        <div id="sync-indicator" style="display: none; text-align: center; color: var(--text-sec); font-size: 0.8rem; margin-bottom: 10px;">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...</div>

        <div class="dashboard">
            <div class="card c-single" id="card-single" onclick="showExplain('single')">
                <div class="chart-container">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" id="circle-s" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage" id="txt-s">0</text>
                    </svg>
                </div>
                <div class="card-label">Ù…ÙØ±Ø¯ Ù…ØªØ§Ø­</div>
                <div class="card-sub">Ø³Ø¹Ø©: 4</div>
            </div>

            <div class="card c-suite" id="card-suite" onclick="showExplain('suite')">
                <div class="chart-container">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" id="circle-r" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage" id="txt-r">0</text>
                    </svg>
                </div>
                <div class="card-label">ÙˆØµØ§Ù„Ø© Ù…ØªØ§Ø­</div>
                <div class="card-sub">Ø³Ø¹Ø©: 20</div>
            </div>
        </div>

        <div id="upgrade-alert" class="alert-upgrade">
            ğŸš€ Ø§Ù†ØªØ¨Ù‡: ØªÙ… Ø®ØµÙ… <b id="alert-upg-cnt">0</b> Ù…Ù† Ø§Ù„ÙˆØµØ§Ù„Ø© Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…ÙØ±Ø¯
        </div>

        <div class="price-bar" id="price-bar">
            <div class="price-label">ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­ <span id="price-status">(Ø¹Ø§Ø¯ÙŠ)</span></div>
            <div class="price-values">
                <div class="p-val" style="color:var(--color-single)"><span id="p-s">200</span><span>Ù…ÙØ±Ø¯</span></div>
                <div class="p-val" style="color:var(--color-suite)"><span id="p-r">230</span><span>ÙˆØµØ§Ù„Ø©</span></div>
            </div>
        </div>

        <div class="section">
            <div class="sec-title">ğŸ¨ Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            <div class="control-row">
                <div class="control-label lbl-single"><span>ğŸ›ï¸</span> Ù…Ø¬Ø¯Ø¯ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('stayS', -1, 4)">âˆ’</button>
                    <span class="val-display" id="disp-stayS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('stayS', 1, 4)">+</button>
                </div>
            </div>
            <div class="cap-bar-bg"><div class="cap-bar-fill" id="bar-stayS"></div></div>
            
            <hr style="border:0; border-top:1px dashed var(--border-color); margin:15px 0;">

            <div class="control-row">
                <div class="control-label lbl-suite"><span>ğŸ›‹ï¸</span> Ù…Ø¬Ø¯Ø¯ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('stayR', -1, 20)">âˆ’</button>
                    <span class="val-display" id="disp-stayR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('stayR', 1, 20)">+</button>
                </div>
            </div>
            <div class="cap-bar-bg"><div class="cap-bar-fill" id="bar-stayR"></div></div>
        </div>

        <div class="section">
            <div class="sec-title">ğŸšª Ù…Ø­ØªÙ…Ù„ Ø®Ø±ÙˆØ¬ (50%)</div>
            <div class="control-row">
                <div class="control-label lbl-single"><span>ğŸšª</span> Ø®Ø±ÙˆØ¬ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('potS', -1, 4)">âˆ’</button>
                    <span class="val-display" id="disp-potS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('potS', 1, 4)">+</button>
                </div>
            </div>
            <div class="control-row" style="margin-top:10px;">
                <div class="control-label lbl-suite"><span>ğŸšª</span> Ø®Ø±ÙˆØ¬ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('potR', -1, 20)">âˆ’</button>
                    <span class="val-display" id="disp-potR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('potR', 1, 20)">+</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="sec-title">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© (Ù…Ø¤ÙƒØ¯)</div>
            <div class="control-row">
                <div class="control-label">Ø¨ÙˆÙƒÙŠÙ†Ø¬ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('bkS', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-bkS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('bkS', 1, 100, true)">+</button>
                </div>
            </div>
            <div class="control-row">
                <div class="control-label">Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('recS', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-recS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('recS', 1, 100, true)">+</button>
                </div>
            </div>
            <hr style="border:0; border-top:1px dashed var(--border-color); margin:15px 0;">
            <div class="control-row">
                <div class="control-label">Ø¨ÙˆÙƒÙŠÙ†Ø¬ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('bkR', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-bkR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('bkR', 1, 100, true)">+</button>
                </div>
            </div>
            <div class="control-row">
                <div class="control-label">Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper" onmousedown="zenStart()" onmouseup="zenEnd()" ontouchstart="zenStart()" ontouchend="zenEnd()">
                    <button class="step-btn btn-minus" onclick="changeVal('recR', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-recR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('recR', 1, 100, true)">+</button>
                </div>
            </div>
        </div>

    </div>

    <div class="sticky-footer">
        <div class="advice-container">
            <div id="adv-single" class="advice-pill pill-green">Ù…ÙØ±Ø¯: 0</div>
            <div id="adv-suite" class="advice-pill pill-green">ÙˆØµØ§Ù„Ø©: 0</div>
        </div>
        
        <div class="actions-row">
            <button id="submit-btn" onclick="sendWhatsApp()">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ğŸš€</button>
            <button id="copy-btn" onclick="copyText()" title="Ù†Ø³Ø® Ø§Ù„Ù†Øµ">ğŸ“‹</button>
        </div>

        <div class="footer-credits">
            ØªØ·ÙˆÙŠØ±: <b>Ø§ÙŠÙ…Ù† Ø§Ø¨Ùˆ ÙˆØ±Ø¯Ù‡</b> | 77aayy@gmail.com
        </div>
    </div>

    <div id="explain-modal" class="modal-overlay" onclick="closeExplain()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="color:var(--primary); margin-top:0;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
            <div id="math-content"></div>
            <button onclick="closeExplain()" style="margin-top:20px; width:100%; padding:15px; border:none; background:var(--bg-body); border-radius:15px; color:var(--text-main); font-weight:bold; cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>
    
    <div id="password-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 style="color:var(--danger); margin-top:0;">ğŸ”’ ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <p style="color:var(--text-sec); font-size:0.9rem;">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©</p>
            <input type="password" id="admin-password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
            <button onclick="checkPasswordAndReset()" style="width:100%; padding:15px; border:none; border-radius:15px; background:var(--danger); color:white; font-weight:bold; margin-bottom:10px; cursor:pointer;">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØµÙÙŠØ±</button>
            <button onclick="document.getElementById('password-modal').style.display='none'" style="width:100%; padding:12px; border:none; background:var(--bg-body); color:var(--text-main); border-radius:15px; font-weight:bold; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>

    <script>
        // --- 1. Security & Config ---
        // ğŸ”’ HASHED PASSWORD "fahd5"
        function simpleHash(s) {
            let h = 0xdeadbeef;
            for(let i=0;i<s.length;i++) h = Math.imul(h ^ s.charCodeAt(i), 2654435761);
            return ((h ^ h >>> 16) >>> 0);
        }
        const ADMIN_HASH = 97325605; // Hash for "fahd5"

        // ğŸ”¥ Firebase Configuration
       const firebaseConfig = {
  apiKey: "AIzaSyD0r1Fc9cCf0d1f1Bb8Gj4P9a3ZJpgmb-20",
  authDomain: "adora-staff7036.firebaseapp.com",
  projectId: "adora-staff7036",
  storageBucket: "adora-staff7036.firebasestorage.app",
  messagingSenderId: "59993381729",
  appId: "1:59993381729:web:cdc0e275255347a0eb2476"
};
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const collectionName = 'occupancyState_v1'; // Distinct collection for manager

        // --- Constants & Config ---
        const CAP_S = 4, CAP_R = 20; const RISK = 0.5;
        // Pricing Matrix [Std, Med, High]
        const P_REG_S = [200, 230, 250]; const P_REG_R = [230, 250, 280];
        const P_SEA_S = [280, 330, 380]; const P_SEA_R = [330, 380, 420];

        // State
        let s = { stayS:0, stayR:0, potS:0, potR:0, bkS:0, bkR:0, recS:0, recR:0, history: [] };
        let calc = {};
        let isSeason = false;
        let sessionSales = 0; // Local counter

        window.onload = () => { loadData(); checkTheme(); };

        // --- Interactive Functions ---
        function changeVal(key, amount, maxCap, isSale = false) {
            let val = s[key] + amount;
            if (val < 0) val = 0;
            if (['stayS','potS'].includes(key) && (s.stayS + s.potS + amount > CAP_S)) { vibrate(50); return; }
            if (['stayR','potR'].includes(key) && (s.stayR + s.potR + amount > CAP_R)) { vibrate(50); return; }
            
            s[key] = val;
            vibrate(10);
            
            // Anim
            const el = document.getElementById('disp-'+key);
            el.classList.remove('pop-anim'); void el.offsetWidth; el.classList.add('pop-anim');
            
            // Log Action (For Memory Protection Logic)
            if (!s.history) s.history = [];
            s.history.push({ action: key, val: amount, time: Date.now() });
            
            // Gamification (Local)
            if(isSale && amount > 0) {
                sessionSales++;
                showToast(`ğŸš€ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´ÙØª: ${sessionSales}`);
            }

            saveData(); updateUI();
        }

        function toggleSeason() {
            isSeason = !isSeason;
            const btn = document.getElementById('season-btn');
            if(isSeason) btn.classList.add('active'); else btn.classList.remove('active');
            updateUI(); // Local Toggle
        }

        function zenStart() { document.body.classList.add('zen-active'); }
        function zenEnd() { document.body.classList.remove('zen-active'); }

        // --- Core Logic ---
        function updateUI() {
            // Update Displays
            for (let k in s) {
                if(document.getElementById('disp-'+k)) document.getElementById('disp-'+k).innerText = s[k];
            }
            
            // Update Progress Bars
            updateBar('bar-stayS', s.stayS, CAP_S);
            updateBar('bar-stayR', s.stayR, CAP_R);

            // Calculation
            const gainS = Math.floor(s.potS * RISK); const gainR = Math.floor(s.potR * RISK);
            let netS = (CAP_S - (s.stayS + s.potS) + gainS) - (s.bkS + s.recS);
            let netR = (CAP_R - (s.stayR + s.potR) + gainR) - (s.bkR + s.recR);
            let upg = 0;
            if (netS < 0 && netR > 0) { upg = Math.min(Math.abs(netS), netR); netS += upg; netR -= upg; }
            calc = { netS, netR, upg, gainS, gainR };

            // Update Charts
            updateChart('circle-s', 'txt-s', netS, CAP_S, '#card-single', 'c-single');
            updateChart('circle-r', 'txt-r', netR, CAP_R, '#card-suite', 'c-suite');

            // Upgrade Alert
            const alert = document.getElementById('upgrade-alert');
            if (upg > 0) { alert.style.display = 'block'; document.getElementById('alert-upg-cnt').innerText = upg; } 
            else alert.style.display = 'none';

            // Advice Pills
            updateAdvicePill('adv-single', 'Ù…ÙØ±Ø¯', netS); updateAdvicePill('adv-suite', 'ÙˆØµØ§Ù„Ø©', netR);

            // Pricing Logic
            updatePricing(netS, netR);
        }

        function updatePricing(netS, netR) {
            let lvlS = 0; if(netS < 1) lvlS = 2; else if(netS < 2) lvlS = 1;
            let lvlR = 0; if(netR < 5) lvlR = 2; else if(netR < 10) lvlR = 1;
            let globalLvl = Math.max(lvlS, lvlR); 
            
            const pricesS = isSeason ? P_SEA_S : P_REG_S;
            const pricesR = isSeason ? P_SEA_R : P_REG_R;

            document.getElementById('p-s').innerText = pricesS[globalLvl];
            document.getElementById('p-r').innerText = pricesR[globalLvl];

            const bar = document.getElementById('price-bar');
            const statusTxt = document.getElementById('price-status');
            
            bar.className = 'price-bar'; // reset
            if(globalLvl === 0) { bar.classList.add('price-mode-std'); statusTxt.innerText = '(Ù‚ÙŠØ§Ø³ÙŠ)'; }
            else if(globalLvl === 1) { bar.classList.add('price-mode-med'); statusTxt.innerText = '(Ù…ØªÙˆØ³Ø·)'; }
            else { bar.classList.add('price-mode-high'); statusTxt.innerText = '(Ù…Ø±ØªÙØ¹)'; }
        }

        function updateBar(id, val, cap) {
            const el = document.getElementById(id);
            if(!el) return;
            let pct = (val / cap) * 100;
            el.style.width = pct + '%';
            if(pct > 90) el.style.background = 'var(--danger)';
            else if(pct > 50) el.style.background = 'var(--warning)';
            else el.style.background = 'var(--success)';
        }

        function updateChart(cId, tId, val, cap, cardId, cls) {
            const circle = document.getElementById(cId); const txt = document.getElementById(tId); const card = document.querySelector(cardId);
            let pct = val > 0 ? (val/cap)*100 : 0; if(pct>100) pct=100; if(pct<0) pct=0;
            circle.setAttribute('stroke-dasharray', `${pct}, 100`); txt.innerText = val;
            card.className = `card ${cls}`;
            if(val>0) circle.style.stroke = (cls==='c-single')?'var(--color-single)':'var(--color-suite)';
            else if(val===0) { circle.style.stroke='var(--warning)'; card.classList.add('stat-warn'); }
            else { circle.style.stroke='var(--danger)'; card.classList.add('stat-danger'); }
        }

        function updateAdvicePill(id, name, val) {
            const el = document.getElementById(id);
            if (val > 0) { el.className = 'advice-pill pill-green'; el.innerText = `âœ… Ø§ÙØªØ­ ${name} (${val})`; }
            else { el.className = 'advice-pill pill-red'; el.innerText = `â›” Ø£ØºÙ„Ù‚ ${name}`; }
        }

        function showToast(msg) {
            const t = document.getElementById('game-toast');
            document.getElementById('sales-count').innerText = sessionSales;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 2000);
        }

        // --- Utils ---
        function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('abella_theme', document.body.classList.contains('dark-mode')?'dark':'light'); }
        function checkTheme() { if(localStorage.getItem('abella_theme')==='dark') document.body.classList.add('dark-mode'); }
        
        // --- Report Generation ---
        function getReportText() {
            const t = new Date().toLocaleTimeString('ar-EG',{hour:'numeric',minute:'numeric',hour12:true});
            const upgMsg = calc.upg > 0 ? `\n(âš ï¸ ØªÙ… Ø®ØµÙ… ${calc.upg} Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…ÙØ±Ø¯)` : "";
       const ps = document.getElementById('p-s').innerText;
            const pr = document.getElementById('p-r').innerText;
            
            return `*ØªÙ‚Ø±ÙŠØ± Ù…Ù†Ø¸ÙˆÙ…Ø© Adora ğŸ¨*\nğŸ•’ ${t}\n------------------\nğŸ“Š *Ù…ØªØ§Ø­ Ù„Ù„Ø¨ÙŠØ¹*\nâ€¢ Ù…ÙØ±Ø¯: *${calc.netS}*\nâ€¢ ØºØ±ÙØ© ÙˆØµØ§Ù„Ø©: *${calc.netR}* ${upgMsg}\n------------------\nğŸ’° *Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©*\nâ€¢ Ù…ÙØ±Ø¯: ${ps} | ÙˆØµØ§Ù„Ø©: ${pr}\n------------------\nğŸ“ *Ø§Ù„ØªÙØ§ØµÙŠÙ„*\nâ€¢ Ø¥Ù‚Ø§Ù…Ø©: ${s.stayS} Ù…ÙØ±Ø¯ | ${s.stayR} ÙˆØµØ§Ù„Ø©\nâ€¢ Ø®Ø±ÙˆØ¬: ${s.potS} Ù…ÙØ±Ø¯ | ${s.potR} ÙˆØµØ§Ù„Ø©\nâ€¢ Ø­Ø¬ÙˆØ²Ø§Øª: ${s.bkS+s.recS} Ù…ÙØ±Ø¯ | ${s.bkR+s.recR} ÙˆØµØ§Ù„Ø©\n------------------\nğŸ’¡ *Ø§Ù„Ù†ØµÙŠØ­Ø©*\n1ï¸âƒ£ ${calc.netS>0?'âœ… Ø§ÙØªØ­ Ù…ÙØ±Ø¯':'â›” Ø£ØºÙ„Ù‚ Ù…ÙØ±Ø¯'}\n2ï¸âƒ£ ${calc.netR>0?'âœ… Ø§ÙØªØ­ ÙˆØµØ§Ù„Ø©':'â›” Ø£ØºÙ„Ù‚ ÙˆØµØ§Ù„Ø©'}`;
        }
        function sendWhatsApp() { window.open(`https://wa.me/?text=${encodeURIComponent(getReportText())}`, '_blank'); }
        function copyText() { navigator.clipboard.writeText(getReportText()).then(() => { alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± ğŸ“‹"); }); }

        // Explain Modal
        function showExplain(t) {
            const m = document.getElementById('explain-modal'); const c = document.getElementById('math-content'); let h = '';
            if (t==='single') h = genMathHtml(CAP_S, s.stayS, s.potS, calc.gainS, s.bkS+s.recS, calc.netS, calc.upg, 'add');
            else h = genMathHtml(CAP_R, s.stayR, s.potR, calc.gainR, s.bkR+s.recR, calc.netR, calc.upg, 'sub');
            c.innerHTML = h; m.style.display = 'flex';
        }
        function closeExplain() { document.getElementById('explain-modal').style.display = 'none'; }
        function genMathHtml(cap, stay, pot, gain, inc, net, upg, mode) {
            let html = `<div class="math-row"><span>Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</span><b>${cap}</b></div><div class="math-row"><span>(-) Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</span><span>${stay}</span></div><div class="math-row"><span>(-) Ø®Ø±ÙˆØ¬ (Ù…Ø§Ø¯ÙŠ)</span><span>${pot}</span></div><div class="math-row"><span>(+) Ù…ÙƒØ³Ø¨ Ù…Ø®Ø§Ø·Ø±Ø©</span><span>${gain}</span></div><div class="math-row"><span>(-) Ø­Ø¬ÙˆØ²Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</span><span>${inc}</span></div><div style="border-top:1px solid #ccc; margin:5px 0"></div><div class="math-row"><span>= Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø£ÙˆÙ„ÙŠ</span><b>${(cap-(stay+pot)+gain)-inc}</b></div>`;
            if(upg > 0) { if(mode==='add') html += `<div class="math-row" style="color:var(--upgrade)"><span>(+) ØªØºØ·ÙŠØ© ØªØ±Ù‚ÙŠØ©</span><b>${upg}</b></div>`; else html += `<div class="math-row" style="color:var(--upgrade)"><span>(-) Ø®ØµÙ… ØªØ±Ù‚ÙŠØ©</span><b>${upg}</b></div>`; html += `<div class="math-row" style="font-weight:800; color:var(--primary)"><span>= Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><b>${net}</b></div>`; }
            return html;
        }

        // --- ğŸ”¥ Firebase Logic (Replaces localStorage) ---
        
        // 1. Save Data with Sync Indicator & Memory Protection
        function saveData() {
            const indicator = document.getElementById('sync-indicator');
            if (indicator) indicator.style.display = 'block';

            // ğŸ›¡ï¸ Memory Protection: Trim history
            if (s.history && s.history.length > 150) {
                s.history = s.history.slice(s.history.length - 150);
            }

            const mainDocRef = db.collection(collectionName).doc('main');
            
            // ğŸ”¥ Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„ØµØ­ÙŠØ­: Ø§Ø³ØªØ®Ø¯Ø§Ù… update() Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„
            const dataToSave = { 
                stayS: s.stayS, stayR: s.stayR,
                potS: s.potS, potR: s.potR,
                bkS: s.bkS, bkR: s.bkR,
                recS: s.recS, recR: s.recR,
                history: s.history,
                log: s.log || [], // ğŸ”¥ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ Ù„ÙƒÙŠ Ù„Ø§ ÙŠØ­Ø°ÙÙ‡ Firestore
                timestamp: firebase.firestore.FieldValue.serverTimestamp() 
            };

      mainDocRef.set(dataToSave, { merge: true })
    .then(() => {
        if (indicator) setTimeout(() => indicator.style.display = 'none', 1000);
    })
    .catch((error) => {
        console.error("Error saving:", error);
        if (indicator) indicator.innerText = 'âŒ Ø®Ø·Ø£';
    });
}

// 2. Load Data with Self-Healing


        // 2. Load Data with Self-Healing
        function loadData() {
            const mainDocRef = db.collection(collectionName).doc('main');
            
            mainDocRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    // Self-healing: Ensure all keys exist
                    s = { 
                        stayS: data.stayS || 0, stayR: data.stayR || 0,
                        potS: data.potS || 0, potR: data.potR || 0,
                        bkS: data.bkS || 0, bkR: data.bkR || 0,
                        recS: data.recS || 0, recR: data.recR || 0,
                        history: data.history || [],
                        log: data.log || [] // ğŸ”¥ Ø¥Ø¶Ø§ÙØ©: Ù‚Ø±Ø§Ø¡Ø© Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ø§Ù„ (Worker Log)
                    };
                    updateUI();
                } else {
                    // Initialize if empty
                    s = { stayS:0, stayR:0, potS:0, potR:0, bkS:0, bkR:0, recS:0, recR:0, history: [], log: [] };
                    saveData();
                }
            });
        }

        // 3. Secure Reset
        function showResetModal() {
            document.getElementById('password-modal').style.display = 'flex';
        }

        function checkPasswordAndReset() {
            const pwd = document.getElementById('admin-password').value.trim();
            if (simpleHash(pwd) === ADMIN_HASH) {
                s = { stayS:0, stayR:0, potS:0, potR:0, bkS:0, bkR:0, recS:0, recR:0, history: [], log: [] }; 
                sessionSales = 0; 
                saveData(); 
                updateUI();
                document.getElementById('password-modal').style.display = 'none';
                document.getElementById('admin-password').value = '';
                showToast('âœ… ØªÙ… Ø§Ù„ØªØµÙÙŠØ± Ø¨Ù†Ø¬Ø§Ø­');
            } else {
                alert('âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
            }
        }

    </script>
</body>
</html>
