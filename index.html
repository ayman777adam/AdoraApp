<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ØªÙ‚Ø±ÙŠØ± Ø¥Ø´ØºØ§Ù„ ÙÙ†Ø¯Ù‚ Ø£Ø¨ÙŠÙ„Ø§</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- 1. Variables --- */
        :root {
            --bg-body: #f9f4e8;
            --bg-card: #ffffff;
            --text-main: #2d3436;
            --text-sec: #636e72;
            --border-color: #dfe6e9;
            --primary: #0984e3;
            --success: #00b894;
            --danger: #d63031;
            --warning: #f1c40f;
            --upgrade: #6c5ce7;
            --gold-line: rgba(184, 134, 11, 0.15);
            
            --color-single: #0984e3; 
            --color-suite: #b7950b; 
        }

        body.dark-mode {
            --bg-body: #1e1e1e;
            --bg-card: #2d2d2d;
            --text-main: #dfe6e9;
            --text-sec: #b2bec3;
            --border-color: #444;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg-body);
            background-image: 
                linear-gradient(45deg, var(--gold-line) 1px, transparent 1px),
                linear-gradient(-45deg, var(--gold-line) 1px, transparent 1px);
            background-size: 40px 40px;
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 15px 15px 200px 15px; /* Ù…Ø³Ø§Ø­Ø© ÙƒØ¨ÙŠØ±Ø© Ù„Ù„ÙÙˆØªØ± Ø§Ù„Ø«Ø§Ø¨Øª */
            -webkit-tap-highlight-color: transparent;
            transition: 0.3s;
        }

        body.dark-mode { background-image: none; }

        .container { max-width: 500px; margin: 0 auto; }

        /* --- 2. Glass Header --- */
        .header-glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.5);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        body.dark-mode .header-glass { background: rgba(45,45,45,0.7); border-color:rgba(255,255,255,0.1); }
        .header-title h1 { margin: 0; font-size: 1.1rem; color: var(--primary); font-weight: 800; }
        .tools-btn { background: rgba(255,255,255,0.5); border: 1px solid var(--border-color); padding: 8px; border-radius: 10px; cursor: pointer; font-size: 1.1rem; }

        /* --- 3. Dashboard --- */
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 25px; }
        .card { 
            background: var(--bg-card); border-radius: 18px; padding: 15px; 
            position: relative; box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            border-bottom: 4px solid transparent; transition: transform 0.2s;
        }
        .card:active { transform: scale(0.98); }
        
        .chart-container { position: relative; width: 80px; height: 80px; margin-bottom: 10px; }
        .circular-chart { display: block; margin: 0 auto; max-width: 80%; max-height: 250px; }
        .circle-bg { fill: none; stroke: var(--border-color); stroke-width: 3.8; }
        .circle { fill: none; stroke-width: 2.8; stroke-linecap: round; transition: stroke-dasharray 0.6s ease; }
        .percentage { fill: var(--text-main); font-family: 'Tajawal', sans-serif; font-weight: bold; font-size: 0.5em; text-anchor: middle; }
        
        .card-label { font-size: 0.85rem; font-weight: 700; margin-bottom: 2px; }
        .card-sub { font-size: 0.7rem; opacity: 0.7; }
        .c-single .circle { stroke: var(--color-single); } .c-single .card-label { color: var(--color-single); }
        .c-suite .circle { stroke: var(--color-suite); } .c-suite .card-label { color: var(--color-suite); }
        
        .upgrade-badge { font-size: 0.7rem; background-color: var(--upgrade); color: white; padding: 2px 6px; border-radius: 8px; margin-top: 5px; display: none; }

        /* --- 4. Inputs & Steppers --- */
        .section { background: var(--bg-card); border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }
        .sec-title { font-weight: 700; font-size: 1rem; margin-bottom: 15px; padding-bottom: 8px; border-bottom: 1px dashed var(--border-color); }
        
        .control-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .control-label { flex: 1; font-size: 0.9rem; font-weight: 600; color: var(--text-sec); }
        .control-label span { display: block; font-size: 1.2rem; margin-right: 5px; float: right;}
        
        .stepper { display: flex; align-items: center; gap: 10px; background: var(--bg-body); padding: 5px; border-radius: 12px; }
        .step-btn {
            width: 40px; height: 40px; border: none; border-radius: 10px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: 0.1s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .step-btn:active { transform: scale(0.9); }
        .btn-minus { background: #fff; color: var(--danger); }
        .btn-plus { background: #fff; color: var(--success); }
        body.dark-mode .step-btn { background: #444; }
        
        .val-display { font-size: 1.3rem; font-weight: 800; width: 30px; text-align: center; transition: transform 0.1s; }
        .pop-anim { transform: scale(1.3); color: var(--primary); }

        .cap-bar-bg { height: 4px; background: var(--border-color); border-radius: 2px; margin-top: 5px; width: 100%; position: relative; overflow: hidden; }
        .cap-bar-fill { height: 100%; width: 0%; background: var(--success); transition: width 0.3s, background 0.3s; }
        .lbl-single { color: var(--color-single); } .lbl-suite { color: var(--color-suite); }

        /* --- 5. Sticky Bottom Bar (Updated) --- */
        .sticky-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-top: 1px solid rgba(0,0,0,0.1);
            padding: 15px 15px 5px 15px; /* Padding bottom reduced */
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            z-index: 999;
            display: flex; flex-direction: column; gap: 8px;
            box-sizing: border-box;
            border-radius: 20px 20px 0 0;
        }
        body.dark-mode .sticky-footer { background: rgba(35,35,35,0.98); border-color: #555; }

        .advice-container { display: flex; gap: 10px; }
        .advice-pill {
            flex: 1; padding: 10px; border-radius: 12px; text-align: center;
            font-weight: 800; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px;
            transition: 0.3s;
        }
        .pill-green { background: rgba(0, 184, 148, 0.15); color: var(--success); border: 1px solid rgba(0, 184, 148, 0.3); }
        .pill-red { background: rgba(214, 48, 49, 0.15); color: var(--danger); border: 1px solid rgba(214, 48, 49, 0.3); }

        .actions-row { display: flex; gap: 10px; }
        
        #submit-btn {
            flex: 1; padding: 14px; border: none; border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), #0984e3);
            color: white; font-weight: 800; font-size: 1.1rem;
            cursor: pointer; box-shadow: 0 4px 15px rgba(9, 132, 227, 0.3);
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        #copy-btn {
            width: 50px; border: none; border-radius: 12px;
            background: var(--input-bg); color: var(--text-sec);
            font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
            border: 1px solid var(--border-color);
        }
        
        /* Footer Credits Inside Sticky */
        .footer-credits {
            text-align: center; font-size: 0.7rem; color: #b2bec3;
            padding-top: 5px; padding-bottom: 5px;
            border-top: 1px dashed rgba(0,0,0,0.05);
            margin-top: 5px;
        }
        .footer-credits b { color: var(--text-sec); }

        .alert-upgrade { background: rgba(108, 92, 231, 0.1); color: var(--upgrade); padding: 10px; border-radius: 10px; border: 1px solid var(--upgrade); text-align: center; font-size: 0.9rem; margin-bottom: 15px; display: none; }
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: var(--bg-card); padding: 25px; border-radius: 20px; width: 85%; max-width: 350px; text-align: center; }
        .math-row { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-glass">
            <div class="header-title">
                <h1>ØªÙ‚Ø±ÙŠØ± Ø¥Ø´ØºØ§Ù„ ÙÙ†Ø¯Ù‚ Ø£Ø¨ÙŠÙ„Ø§</h1>
            </div>
            <div style="display:flex; gap:8px;">
                <button class="tools-btn" onclick="toggleDarkMode()">ğŸŒ™</button>
                <button class="tools-btn" onclick="resetData()">ğŸ”„</button>
            </div>
        </div>

        <div class="dashboard">
            <div class="card c-single" id="card-single" onclick="showExplain('single')">
                <div class="chart-container">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" id="circle-s" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage" id="txt-s">0</text>
                    </svg>
                </div>
                <div class="card-label">Ù…ÙØ±Ø¯ Ù…ØªØ§Ø­</div>
                <div class="card-sub">Ø³Ø¹Ø©: 4</div>
            </div>

            <div class="card c-suite" id="card-suite" onclick="showExplain('suite')">
                <div class="chart-container">
                    <svg viewBox="0 0 36 36" class="circular-chart">
                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <path class="circle" id="circle-r" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
                        <text x="18" y="20.35" class="percentage" id="txt-r">0</text>
                    </svg>
                </div>
                <div class="card-label">ÙˆØµØ§Ù„Ø© Ù…ØªØ§Ø­</div>
                <div class="card-sub">Ø³Ø¹Ø©: 20</div>
                <div id="upgrade-badge" class="upgrade-badge">âš¡ ØªØ±Ù‚ÙŠØ©: 0</div>
            </div>
        </div>

        <div id="upgrade-alert" class="alert-upgrade">
            ğŸš€ Ø§Ù†ØªØ¨Ù‡: ØªÙ… Ø®ØµÙ… <b id="alert-upg-cnt">0</b> Ù…Ù† Ø§Ù„ÙˆØµØ§Ù„Ø© Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…ÙØ±Ø¯
        </div>

        <div class="section">
            <div class="sec-title">ğŸ¨ Ø§Ù„Ø¥Ø´ØºØ§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
            
            <div class="control-row">
                <div class="control-label lbl-single"><span>ğŸ›ï¸</span> Ù…Ø¬Ø¯Ø¯ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('stayS', -1, 4)">âˆ’</button>
                    <span class="val-display" id="disp-stayS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('stayS', 1, 4)">+</button>
                </div>
            </div>
            <div class="cap-bar-bg"><div class="cap-bar-fill" id="bar-stayS"></div></div>
            
            <hr style="border:0; border-top:1px dashed #eee; margin:15px 0;">

            <div class="control-row">
                <div class="control-label lbl-suite"><span>ğŸ›‹ï¸</span> Ù…Ø¬Ø¯Ø¯ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('stayR', -1, 20)">âˆ’</button>
                    <span class="val-display" id="disp-stayR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('stayR', 1, 20)">+</button>
                </div>
            </div>
            <div class="cap-bar-bg"><div class="cap-bar-fill" id="bar-stayR"></div></div>
        </div>

        <div class="section">
            <div class="sec-title">ğŸšª Ù…Ø­ØªÙ…Ù„ Ø®Ø±ÙˆØ¬ (50%)</div>
            <div class="control-row">
                <div class="control-label lbl-single"><span>ğŸšª</span> Ø®Ø±ÙˆØ¬ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('potS', -1, 4)">âˆ’</button>
                    <span class="val-display" id="disp-potS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('potS', 1, 4)">+</button>
                </div>
            </div>
            <div class="control-row" style="margin-top:15px;">
                <div class="control-label lbl-suite"><span>ğŸšª</span> Ø®Ø±ÙˆØ¬ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('potR', -1, 20)">âˆ’</button>
                    <span class="val-display" id="disp-potR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('potR', 1, 20)">+</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="sec-title">ğŸ“… Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</div>
            <div class="control-row">
                <div class="control-label">Ø¨ÙˆÙƒÙŠÙ†Ø¬ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('bkS', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-bkS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('bkS', 1, 100)">+</button>
                </div>
            </div>
            <div class="control-row">
                <div class="control-label">Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (Ù…ÙØ±Ø¯)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('recS', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-recS">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('recS', 1, 100)">+</button>
                </div>
            </div>
            <hr style="border:0; border-top:1px dashed #eee; margin:15px 0;">
            <div class="control-row">
                <div class="control-label">Ø¨ÙˆÙƒÙŠÙ†Ø¬ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('bkR', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-bkR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('bkR', 1, 100)">+</button>
                </div>
            </div>
            <div class="control-row">
                <div class="control-label">Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (ÙˆØµØ§Ù„Ø©)</div>
                <div class="stepper">
                    <button class="step-btn btn-minus" onclick="changeVal('recR', -1, 100)">âˆ’</button>
                    <span class="val-display" id="disp-recR">0</span>
                    <button class="step-btn btn-plus" onclick="changeVal('recR', 1, 100)">+</button>
                </div>
            </div>
        </div>
    </div>

    <div class="sticky-footer">
        <div class="advice-container">
            <div id="adv-single" class="advice-pill pill-green">Ù…ÙØ±Ø¯: 0</div>
            <div id="adv-suite" class="advice-pill pill-green">ÙˆØµØ§Ù„Ø©: 0</div>
        </div>
        
        <div class="actions-row">
            <button id="submit-btn" onclick="sendWhatsApp()">Ø¥Ø±Ø³Ø§Ù„ ÙˆØ§ØªØ³Ø§Ø¨ ğŸš€</button>
            <button id="copy-btn" onclick="copyText()" title="Ù†Ø³Ø® Ø§Ù„Ù†Øµ">ğŸ“‹</button>
        </div>

        <div class="footer-credits">
            ØªØ·ÙˆÙŠØ±: <b>Ø§ÙŠÙ…Ù† Ø§Ø¨Ùˆ ÙˆØ±Ø¯Ù‡</b> | 77aayy@gmail.com
        </div>
    </div>

    <div id="explain-modal" class="modal-overlay" onclick="closeExplain()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="color:var(--primary); margin-top:0;">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
            <div id="math-content"></div>
            <button onclick="closeExplain()" style="margin-top:15px; width:100%; padding:10px; border:none; background:#eee; border-radius:10px;">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <script>
        const CAP_S = 4, CAP_R = 20; const RISK = 0.5;
        let s = { stayS:0, stayR:0, potS:0, potR:0, bkS:0, bkR:0, recS:0, recR:0 };
        let calc = {};

        window.onload = () => { loadData(); checkTheme(); updateUI(); };

        function changeVal(key, amount, maxCap) {
            let val = s[key] + amount;
            if (val < 0) val = 0;
            if (['stayS','potS'].includes(key) && (s.stayS + s.potS + amount > CAP_S)) { vibrate(50); return; }
            if (['stayR','potR'].includes(key) && (s.stayR + s.potR + amount > CAP_R)) { vibrate(50); return; }
            s[key] = val;
            vibrate(10); 
            // Trigger Animation
            const el = document.getElementById('disp-'+key);
            el.classList.remove('pop-anim');
            void el.offsetWidth; // Trigger reflow
            el.classList.add('pop-anim');
            saveData(); updateUI();
        }

        function updateUI() {
            for (let k in s) { const el = document.getElementById('disp-'+k); if(el) el.innerText = s[k]; }
            updateBar('bar-stayS', s.stayS, CAP_S); updateBar('bar-stayR', s.stayR, CAP_R);
            const gainS = Math.floor(s.potS * RISK); const gainR = Math.floor(s.potR * RISK);
            let netS = (CAP_S - (s.stayS + s.potS) + gainS) - (s.bkS + s.recS);
            let netR = (CAP_R - (s.stayR + s.potR) + gainR) - (s.bkR + s.recR);
            let upg = 0; if (netS < 0 && netR > 0) { upg = Math.min(Math.abs(netS), netR); netS += upg; netR -= upg; }
            calc = { netS, netR, upg, gainS, gainR };
            updateChart('circle-s', 'txt-s', netS, CAP_S, '#card-single', 'c-single');
            updateChart('circle-r', 'txt-r', netR, CAP_R, '#card-suite', 'c-suite');
            const alert = document.getElementById('upgrade-alert');
            const badge = document.getElementById('upgrade-badge');
            if (upg > 0) {
                alert.style.display = 'block'; document.getElementById('alert-upg-cnt').innerText = upg;
                badge.style.display = 'inline-block'; badge.innerText = `âš¡ ØªØ±Ù‚ÙŠØ©: ${upg}`;
            } else { alert.style.display = 'none'; badge.style.display = 'none'; }
            updateAdvicePill('adv-single', 'Ù…ÙØ±Ø¯', netS); updateAdvicePill('adv-suite', 'ÙˆØµØ§Ù„Ø©', netR);
        }

        function updateBar(id, val, cap) {
            const el = document.getElementById(id); if(!el) return;
            let pct = (val / cap) * 100; el.style.width = pct + '%';
            if(pct > 90) el.style.background = 'var(--danger)'; else if(pct > 50) el.style.background = 'var(--warning)'; else el.style.background = 'var(--success)';
        }
        function updateChart(circleId, txtId, val, cap, cardId, baseClass) {
            const circle = document.getElementById(circleId); const txt = document.getElementById(txtId); const card = document.querySelector(cardId);
            let pct = 0; if(val > 0) pct = (val / cap) * 100; if(pct>100) pct=100; if(pct<0) pct=0;
            circle.setAttribute('stroke-dasharray', `${pct}, 100`); txt.innerText = val;
            card.className = `card ${baseClass}`;
            if (val > 0) { circle.style.stroke = (baseClass === 'c-single') ? 'var(--color-single)' : 'var(--color-suite)'; }
            else if (val === 0) { circle.style.stroke = 'var(--warning)'; card.classList.add('stat-warn'); }
            else { circle.style.stroke = 'var(--danger)'; card.classList.add('stat-danger'); }
        }
        function updateAdvicePill(id, name, val) {
            const el = document.getElementById(id);
            if (val > 0) { el.className = 'advice-pill pill-green'; el.innerText = `âœ… Ø§ÙØªØ­ ${name} (${val})`; }
            else { el.className = 'advice-pill pill-red'; el.innerText = `â›” Ø£ØºÙ„Ù‚ ${name}`; }
        }
        function vibrate(ms) { if (navigator.vibrate) navigator.vibrate(ms); }
        function saveData() { localStorage.setItem('abella_v4', JSON.stringify(s)); }
        function loadData() { const d = JSON.parse(localStorage.getItem('abella_v4')); if(d) s = d; }
        function resetData() { if(confirm('ØªØµÙÙŠØ± Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§ØªØŸ')) { s = { stayS:0, stayR:0, potS:0, potR:0, bkS:0, bkR:0, recS:0, recR:0 }; saveData(); updateUI(); } }
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('abella_theme', document.body.classList.contains('dark-mode')?'dark':'light'); }
        function checkTheme() { if(localStorage.getItem('abella_theme')==='dark') document.body.classList.add('dark-mode'); }
        function showExplain(t) {
            const m = document.getElementById('explain-modal'); const c = document.getElementById('math-content'); let h = '';
            if (t==='single') h = genMathHtml(CAP_S, s.stayS, s.potS, calc.gainS, s.bkS+s.recS, calc.netS, calc.upg, 'add');
            else h = genMathHtml(CAP_R, s.stayR, s.potR, calc.gainR, s.bkR+s.recR, calc.netR, calc.upg, 'sub');
            c.innerHTML = h; m.style.display = 'flex';
        }
        function closeExplain() { document.getElementById('explain-modal').style.display = 'none'; }
        function genMathHtml(cap, stay, pot, gain, inc, net, upg, mode) {
            let html = `<div class="math-row"><span>Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</span><b>${cap}</b></div><div class="math-row"><span>(-) Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹</span><span>${stay}</span></div><div class="math-row"><span>(-) Ø®Ø±ÙˆØ¬ (Ù…Ø§Ø¯ÙŠ)</span><span>${pot}</span></div><div class="math-row"><span>(+) Ù…ÙƒØ³Ø¨ Ù…Ø®Ø§Ø·Ø±Ø©</span><span>${gain}</span></div><div class="math-row"><span>(-) Ø­Ø¬ÙˆØ²Ø§Øª Ù‚Ø§Ø¯Ù…Ø©</span><span>${inc}</span></div><div style="border-top:1px solid #ccc; margin:5px 0"></div><div class="math-row"><span>= Ø§Ù„ØµØ§ÙÙŠ Ø§Ù„Ø£ÙˆÙ„ÙŠ</span><b>${(cap-(stay+pot)+gain)-inc}</b></div>`;
            if(upg > 0) { if(mode==='add') html += `<div class="math-row" style="color:var(--upgrade)"><span>(+) ØªØºØ·ÙŠØ© ØªØ±Ù‚ÙŠØ©</span><b>${upg}</b></div>`; else html += `<div class="math-row" style="color:var(--upgrade)"><span>(-) Ø®ØµÙ… ØªØ±Ù‚ÙŠØ©</span><b>${upg}</b></div>`; html += `<div class="math-row" style="font-weight:800; color:var(--primary)"><span>= Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><b>${net}</b></div>`; }
            return html;
        }

        function getReportText() {
            const t = new Date().toLocaleTimeString('ar-EG',{hour:'numeric',minute:'numeric',hour12:true});
            const upgMsg = calc.upg > 0 ? `\n(âš ï¸ ØªÙ… Ø®ØµÙ… ${calc.upg} Ù„ØªØ±Ù‚ÙŠØ© Ø§Ù„Ù…ÙØ±Ø¯)` : "";
            return `*ØªÙ‚Ø±ÙŠØ± ÙÙ†Ø¯Ù‚ Ø£Ø¨ÙŠÙ„Ø§ ğŸ¨*\nğŸ•’ ${t}\n------------------\nğŸ“Š *Ù…ØªØ§Ø­ Ù„Ù„Ø¨ÙŠØ¹*\nâ€¢ Ù…ÙØ±Ø¯: *${calc.netS}*\nâ€¢ ØºØ±ÙØ© ÙˆØµØ§Ù„Ø©: *${calc.netR}* ${upgMsg}\n------------------\nğŸ“ *Ø§Ù„ØªÙØ§ØµÙŠÙ„*\nâ€¢ Ø¥Ù‚Ø§Ù…Ø©: ${s.stayS} Ù…ÙØ±Ø¯ | ${s.stayR} ÙˆØµØ§Ù„Ø©\nâ€¢ Ø®Ø±ÙˆØ¬: ${s.potS} Ù…ÙØ±Ø¯ | ${s.potR} ÙˆØµØ§Ù„Ø©\nâ€¢ Ø­Ø¬ÙˆØ²Ø§Øª: ${s.bkS+s.recS} Ù…ÙØ±Ø¯ | ${s.bkR+s.recR} ÙˆØµØ§Ù„Ø©\n------------------\nğŸ’¡ *Ø§Ù„Ù†ØµÙŠØ­Ø©*\n1ï¸âƒ£ ${calc.netS>0?'âœ… Ø§ÙØªØ­ Ù…ÙØ±Ø¯':'â›” Ø£ØºÙ„Ù‚ Ù…ÙØ±Ø¯'}\n2ï¸âƒ£ ${calc.netR>0?'âœ… Ø§ÙØªØ­ ÙˆØµØ§Ù„Ø©':'â›” Ø£ØºÙ„Ù‚ ÙˆØµØ§Ù„Ø©'}`;
        }
        function sendWhatsApp() { window.open(`https://wa.me/?text=${encodeURIComponent(getReportText())}`, '_blank'); }
        function copyText() { navigator.clipboard.writeText(getReportText()).then(() => { alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ‚Ø±ÙŠØ± ğŸ“‹"); }); }
    </script>
</body>
</html>
